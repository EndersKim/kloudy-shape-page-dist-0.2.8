(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2b23dcb8"],{"0f40":function(t,e,n){},"498a":function(t,e,n){"use strict";var o=n("23e7"),a=n("58a8").trim,s=n("c8d2");o({target:"String",proto:!0,forced:s("trim")},{trim:function(){return a(this)}})},5899:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(t,e,n){var o=n("e330"),a=n("1d80"),s=n("577e"),i=n("5899"),c=o("".replace),r="["+i+"]",m=RegExp("^"+r+r+"*"),_=RegExp(r+r+"*$"),l=function(t){return function(e){var n=s(a(e));return 1&t&&(n=c(n,m,"")),2&t&&(n=c(n,_,"")),n}};t.exports={start:l(1),end:l(2),trim:l(3)}},b57b:function(t,e,n){"use strict";n("0f40")},c8d2:function(t,e,n){var o=n("5e77").PROPER,a=n("d039"),s=n("5899"),i="​᠎";t.exports=function(t){return a((function(){return!!s[t]()||i[t]()!==i||o&&s[t].name!==t}))}},e419:function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"CommunityPost"},[n("div",{staticClass:"community_post_section section"},[n("div",{staticClass:"comments_title"},[n("h3",{staticClass:"section_title"},[t._v(t._s(t.$Text("Comments")))]),n("p",{staticClass:"comments_count"},[t._v(t._s(t.post&&t.post.comments_count))])]),n("div",{staticClass:"comments_viewer"},[n("div",{staticClass:"comments_main",class:{active_animation:t.active_animation}},[n("PlaceHolder",{attrs:{loading:!t.comments}}),n("transition",{attrs:{name:"comment_empty_transition"}},[t.comments&&0==t.comments.length?n("PlaceHolder",{attrs:{empty:t.comments&&0==t.comments.length,empty_title:t.$App.text.NoComments}}):t._e()],1),n("transition-group",{attrs:{name:"comment_transition"}},t._l(t.comments,(function(e){return n("Comment",{key:e.comment_no,ref:"comment_ref",refInFor:!0,attrs:{comment:e},on:{view_user_event:t.view_user_event,refresh_event:function(e){return t.get_post()},reply_comment_event:t.reply_comment_event,delete_comment_event:t.delete_comment_event,loaded:t.comment_loaded,archor_event:t.archor_event}})})),1)],1),t.post?n("div",{staticClass:"comments_tools blur_part"},[n("Pagination",{attrs:{count:t.post.comments_count},model:{value:t.post_page,callback:function(e){t.post_page=e},expression:"post_page"}}),n("div",{staticStyle:{flex:"1"}}),n("ButtonI",{staticClass:"comments_tools_button",attrs:{icon:"submit"},nativeOn:{click:function(e){t.open_write_comment_dialog=!0,t.reply_target=null}}},[t._v(t._s(t.$Text("Write Comment")))])],1):t._e()]),n("transition",{attrs:{name:"comments_loading_mask_fade"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}],staticClass:"comments_loading"},[n("div",{staticClass:"comments_loading_icon_box"},[n("i",{staticClass:"el-icon-loading"})])])])],1),n("Dialog",{attrs:{open:t.open_delete_dialog},on:{close:function(e){t.open_delete_dialog=!1,t.compute_comment_el_height()}}},[t.delete_target?n("div",{staticClass:"confirm_dialog"},[n("p",{staticClass:"confirm_dialog_title"},[t._v("是否确认删除以下评论")]),n("div",{staticStyle:{height:"20px"}}),n("div",{staticClass:"add_comment_reply_target"},[n("p",{staticClass:"add_comment_reply_target_character_name"},[t._v(t._s(t.delete_target.character.nickname))]),n("p",{staticClass:"add_comment_reply_target_cotent",domProps:{innerHTML:t._s(t.display_content(t.delete_target.content))}})]),n("p",{staticClass:"comment_warning"},[t._v("删除评论会同时删除所有对该评论的回复")]),n("div",{staticClass:"confirm_dialog_button_container"},[n("ButtonI",{attrs:{type:"danger",icon:"confirm"},nativeOn:{click:function(e){return t.delete_comment_request()}}},[t._v(t._s(t.$App.text.Confirm))]),n("ButtonI",{attrs:{type:"plain",icon:"cancel"},nativeOn:{click:function(e){t.open_delete_dialog=!1,t.compute_comment_el_height()}}},[t._v(t._s(t.$App.text.Cancel))])],1)]):t._e()]),n("Dialog",{attrs:{open:t.open_user_dialog,title:t.$Text("Information")},on:{close:function(e){t.open_user_dialog=!1}}},[n("div",{staticClass:"user_dialog"},[n("CharacterCard",{attrs:{character:t.user_dialog}})],1)]),n("Dialog",{attrs:{open:t.open_write_comment_dialog,title:t.$Text("Write Comment")},on:{close:function(e){t.open_write_comment_dialog=!1}}},[n("div",{staticClass:"write_comment_dialog"},[t.$Account.active_character?n("div",{staticClass:"add_comment_character"},[n("Avatar",{attrs:{slot:"reference",avatar_url:t.$Account.active_character.avatar_url,nickname:t.$Account.active_character.nickname,size:40},slot:"reference"}),n("p",{staticClass:"character_name"},[t._v(t._s(t.$Account.active_character.nickname))]),n("div",{staticStyle:{flex:"1"}}),n("ButtonI",{attrs:{type:"plain",icon:"settings"},nativeOn:{click:function(e){return t.manage_account.apply(null,arguments)}}},[t._v(t._s(t.$Text("管理账号")))])],1):n("div",{staticClass:"add_comment_new_character"},[n("div",{staticClass:"add_comment_new_character_row"},[n("p",[t._v(" 您未登录，可以 "),n("a",{on:{click:function(e){t.$Account.open_dialog=!0}}},[t._v(t._s(t.$Text("Login"))+" / "+t._s(t.$Text("Register")))]),t._v(" 或者填写以下临时信息发表评论 ")])]),n("table",{staticClass:"form_table"},[n("tr",[n("td",[n("div",{staticClass:"form_table_lable"},[n("i",{staticClass:"el-icon-user form_table_icon"}),n("h4",[t._v(t._s(t.$Text("昵称")))])])]),n("td",[n("input",{directives:[{name:"model",rawName:"v-model",value:t.comment_info.nickname,expression:"comment_info.nickname"}],staticClass:"input",attrs:{placeholder:t.$Text("必填")},domProps:{value:t.comment_info.nickname},on:{input:function(e){e.target.composing||t.$set(t.comment_info,"nickname",e.target.value)}}}),n("p",[t._v(t._s(t.$Text("必填，作为显示名称")))])])]),n("tr",[n("td",[n("div",{staticClass:"form_table_lable"},[n("i",{staticClass:"el-icon-message form_table_icon"}),n("h4",[t._v(t._s(t.$Text("邮箱")))])])]),n("td",[n("input",{directives:[{name:"model",rawName:"v-model",value:t.comment_info.email,expression:"comment_info.email"}],staticClass:"input",domProps:{value:t.comment_info.email},on:{input:function(e){e.target.composing||t.$set(t.comment_info,"email",e.target.value)}}}),n("p",[t._v(t._s(t.$Text("选填，绝对不会公开显示，仅用于通过Cravatar头像服务获取显示头像，输入数字QQ邮箱可以获取QQ头像")))])])]),n("tr",[n("td",[n("div",{staticClass:"form_table_lable"},[n("i",{staticClass:"el-icon-guide form_table_icon"}),n("h4",[t._v(t._s(t.$Text("网站")))])])]),n("td",[n("input",{directives:[{name:"model",rawName:"v-model",value:t.comment_info.website,expression:"comment_info.website"}],staticClass:"input",domProps:{value:t.comment_info.website},on:{input:function(e){e.target.composing||t.$set(t.comment_info,"website",e.target.value)}}}),n("p",[t._v(t._s(t.$Text("选填，会公开显示，如果您有个人博客或网站，可以填写在此处")))])])]),n("tr",[n("td"),n("td",[n("FormSwitch",{attrs:{on_text:t.$Text("在浏览器中保存此临时信息"),plain:!0},model:{value:t.comment_info.remember,callback:function(e){t.$set(t.comment_info,"remember",e)},expression:"comment_info.remember"}})],1)])])]),t.reply_target?n("div",{staticClass:"add_comment_reply_target"},[n("p",{staticClass:"add_comment_reply_target_character_name"},[t._v("回复 "+t._s(t.reply_target.character.nickname))]),n("p",{staticClass:"add_comment_reply_target_cotent",domProps:{innerHTML:t._s(t.display_content(t.reply_target.content))}})]):t._e(),n("div",{staticClass:"add_comment_text"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.content,expression:"form.content"}],staticClass:"input textarea",attrs:{placeholder:t.$App.text.WriteComment},domProps:{value:t.form.content},on:{input:function(e){e.target.composing||t.$set(t.form,"content",e.target.value)}}})]),t.$Account.active_character?t._e():[n("FormSwitch",{attrs:{on_text:"我已阅读并同意本站的所有条款",plain:!0},model:{value:t.comment_info.agree,callback:function(e){t.$set(t.comment_info,"agree",e)},expression:"comment_info.agree"}}),n("p",{staticClass:"agree_link"},[t._v("包含 "),n("a",{staticClass:"terms_link",attrs:{href:"/about/terms",target:"_blank"}},[t._v("隐私政策")]),t._v(" 、 "),n("a",{staticClass:"terms_link",attrs:{href:"/about/terms",target:"_blank"}},[t._v("服务条款")]),t._v(" 和 "),n("a",{staticClass:"terms_link",attrs:{href:"/about/terms",target:"_blank"}},[t._v("免责声明")])]),n("div",{staticStyle:{height:"30px"}})],n("div",{staticClass:"add_comment_submit"},[n("ButtonI",{attrs:{icon:"submit"},nativeOn:{click:function(e){return t.add_comment_request()}}},[t._v(t._s(t.$App.text.PostComment))])],1)],2)])],1)},a=[],s=(n("d3b7"),n("3ca3"),n("ddb0"),n("ac1f"),n("5319"),n("fb6a"),n("5b81"),n("498a"),n("e9c4"),n("159b"),{components:{Comment:function(){return Promise.all([n.e("chunk-647fe51c"),n.e("chunk-74108119")]).then(n.bind(null,"1980"))},Avatar:function(){return n.e("chunk-5d1c42a3").then(n.bind(null,"0f0e"))},PlaceHolder:function(){return n.e("chunk-cc07f37e").then(n.bind(null,"a71f"))},Dialog:function(){return n.e("chunk-06d74022").then(n.bind(null,"8b5f"))},FormRadios:function(){return n.e("chunk-e8330ade").then(n.bind(null,"82b2"))},FormSwitch:function(){return n.e("chunk-396af39a").then(n.bind(null,"3488"))},Pagination:function(){return n.e("chunk-33c81e26").then(n.bind(null,"3092"))},CharacterCard:function(){return n.e("chunk-6c027668").then(n.bind(null,"278c"))},ButtonI:function(){return n.e("chunk-753cb75b").then(n.bind(null,"1e80"))}},props:["post_id"],data:function(){return{post:null,comments:null,post_page:1,order:"recent",active_order:null,form:{content:""},reply_target:null,delete_target:null,comment_info:{nickname:"",email:"",website:"",remember:!0,agree:!1},open_delete_dialog:!1,open_user_dialog:!1,open_write_comment_dialog:!1,delete_dialog:{display_content:null,comment_no:null},user_dialog:{},scroll_target:null,active_animation:!1,loading:!1}},watch:{post_page:function(){this.loading=!0,this.scroll_target=this.$el,this.active_animation=!1,this.get_post()}},mounted:function(){var t=JSON.parse(localStorage.getItem("comment_info"));t&&(this.comment_info=t),this.get_post()},methods:{archor_event:function(t){t&&(this.$App.scroll_to(t.$el),t.$refs.comment_text_box.classList.add("hightlight"),setTimeout((function(){t.$refs.comment_text_box.classList.remove("hightlight")}),1e3))},comment_loaded:function(t){var e=this,n=null;this.$route.hash&&(n=this.$route.hash.slice(1).replace("comment_","")),n==t.comment.comment_no&&(setTimeout((function(){e.$App.scroll_to(t.$el),t.$refs.comment_text_box.classList.add("hightlight")}),500),setTimeout((function(){t.$refs.comment_text_box.classList.remove("hightlight")}),1500))},display_content:function(t){return t.replaceAll("&","&amp;").replaceAll(" ","&nbsp;").replaceAll('\\"',"&quot;").replaceAll("\\'","'").replaceAll("\\\\","\\").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("\r\n","<br />")},get_post:function(){var t=this;this.$axios.get("community/get_post.php",{params:{post_id:this.post_id,page:this.post_page}}).then((function(e){var n=e.data;"success"==n.status?(t.post=n.data.post,t.comments=n.data.post_comments,t.$nextTick((function(){t.get_post_done()}))):(t.comments=null,t.$message({message:n.message,status:"error"}))}))},get_post_done:function(){this.loading=!1,this.scroll_target&&this.$App.scroll_to_immediate(this.scroll_target),this.scroll_target=null},add_comment_action:function(){var t=this,e=new FormData;e.append("content",this.form.content.trim()),e.append("post_id",this.post_id),this.reply_target&&e.append("parent_no",this.reply_target.comment_no),e.append("tokenid",this.$Account.tokenid),e.append("cid",this.$Account.active_character.cid),e.append("device_id",localStorage.getItem("device_id")),this.$axios.post("community/new_comment.php",e).then((function(e){var n=e.data;"success"==n.status?(t.$message({message:"评论发布成功",status:"success"}),t.active_animation=!0,t.get_post(),t.form.content="",t.open_write_comment_dialog=!1):(console.log(n),t.$message({message:n.message||n,status:"error"}))}))},add_comment_character_action:function(){var t=this,e=new FormData;e.append("content",this.form.content.trim()),e.append("post_id",this.post_id),e.append("nickname",this.comment_info.nickname.trim()),e.append("email",this.comment_info.email.trim()),e.append("website",this.comment_info.website.trim()),e.append("device_id",localStorage.getItem("device_id")),this.reply_target&&e.append("parent_no",this.reply_target.comment_no),this.$axios.post("community/new_character_comment.php",e).then((function(e){var n=e.data;"success"==n.status?(t.$message({message:"评论发布成功",status:"success"}),t.active_animation=!0,t.get_post(),t.form.content="",t.open_write_comment_dialog=!1,t.comment_info.remember&&localStorage.setItem("comment_info",JSON.stringify(t.comment_info))):(console.log(n),t.$message({message:n.message||n,status:"error"}))}))},add_comment_request:function(){if(""!=this.form.content.trim())if(this.$Account.active_character)this.add_comment_action();else{if(!this.comment_info.nickname.trim())return void this.$message({showClose:!0,message:"请填写昵称",status:"error"});if(0==this.comment_info.agree)return void this.$message({showClose:!0,message:"需要阅读并同意本站的所有条款",status:"error"});this.add_comment_character_action()}else this.$message({showClose:!0,message:"不能发布空的评论",status:"error"})},reply_comment_event:function(t){this.open_write_comment_dialog=!0,this.reply_target=t},delete_comment_event:function(t){this.open_delete_dialog=!0,this.delete_target=t},compute_comment_el_height:function(){this.$refs.comment_ref.forEach((function(t){t.compute_el_height()}))},delete_comment_request:function(){var t=this,e=new FormData;e.append("tokenid",this.$Account.tokenid),e.append("comment_no",this.delete_target.comment_no),this.$axios.post("community/delete_comment.php",e).then((function(e){var n=e.data;"success"==n.status?(t.get_post(),t.active_animation=!0,t.$message({status:"success",message:"删除成功"}),t.open_delete_dialog=!1):t.$message({status:"error",message:n.message})}))},view_user_event:function(t){this.open_user_dialog=!0,this.user_dialog=t},manage_account:function(){this.open_write_comment_dialog=!1,this.$Account.open_dialog=!0}}}),i=s,c=(n("b57b"),n("2877")),r=Object(c["a"])(i,o,a,!1,null,null,null);e["default"]=r.exports}}]);